{% extends 'base.html' %}
{% load custom_tags static%}

{% block title %}–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞{% endblock %}

{% block content %}
<h1>–ü–û–î–û–ë–†–ê–¢–¨ –ê–í–¢–û–ú–û–ë–ò–õ–¨</h1>
<form method="get" action="{% url 'search_autos' %}" class="search-form">
    <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π...">
    <button type="submit">–ù–∞–π—Ç–∏</button>
</form>

<div class="link">
    <a href="{% url 'news_list' %}">–ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–≤–µ–∂–∏–º –Ω–æ–≤–æ—Å—Ç—è–º...</a>
</div>

<div class="container">

    <!-- —à–∞–±–ª–æ–Ω–Ω—ã–µ —Ç–µ–≥–∏-->
    <p>–í—Å–µ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π: {% count_total_autos %}</p>
    <p>–ê–≤—Ç–æ–º–æ–±–∏–ª–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {% count_filtered_autos autos_page %}</p>
    <h2>–ù–û–í–´–ï –ê–í–¢–û üî•</h2>
    <div class="recent-autos-list">
        {% get_recent_autos as recent_autos %}
        {% for auto in recent_autos %}
        <div class="recent-auto-item">
            <a href="{{ auto.get_absolute_url }}">
                {% if auto.auto_photos.first %}
                    <!-- –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ñ–æ—Ç–æ, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å -->
                    <img src="{{ auto.auto_photos.first.photo.url }}" alt="–§–æ—Ç–æ {{ auto.brand.name }}" class="recent-auto-image">
                {% else %}
                    <!-- –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∑–∞–≥–ª—É—à–∫—É, –µ—Å–ª–∏ —Ñ–æ—Ç–æ –Ω–µ—Ç -->
                    <img src="{% static 'images/no_image_available.png' %}" alt="–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è" class="recent-auto-image">
                {% endif %}
            </a>
            <h4>{{ auto.brand.name }} {{ auto.model }}</h4>
            <p>–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞: {{ auto.year }}</p>
            <p>–¶–µ–Ω–∞: {{ auto.price|floatformat:0 }} ‚ÇΩ</p>
        </div>
        {% empty %}
        <p>–ù–µ—Ç –Ω–µ–¥–∞–≤–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π.</p>
        {% endfor %}
    </div>
    <h2>–ü–æ–¥–æ–±—Ä–∞–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –≤–∞—Å:</h2>
    <div class="autos-list">
        {% for auto_data in autos_with_photos %}
        <div class="auto-item">
            <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–≤—Ç–æ–º–æ–±–∏–ª—è -->
            <a href="{{ auto_data.auto.get_absolute_url }}">
                <h3>{{ auto_data.auto.brand.name }} {{ auto_data.auto.model }}</h3>
                <p>–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞: {{ auto_data.auto.year }}</p>
                <p>–¶–µ–Ω–∞: {{ auto_data.auto.price|floatformat:0 }} ‚ÇΩ</p>
    
                {% for photo in auto_data.photos %}
                    <img src="{{ photo.photo.url }}" alt="–§–æ—Ç–æ {{ auto_data.auto.brand.name }}">
                {% endfor %}
            </a>
        </div>
        {% endfor %}
    </div>
</div>
<!-- –°—Å—ã–ª–∫–∏ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ -->
<div class="pagination">
    {% if autos_page.has_previous %}
        <a href="?page=1">–ü–µ—Ä–≤–∞—è</a>
        <a href="?page={{ autos_page.previous_page_number }}">–ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
    {% endif %}

    <span>–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ autos_page.number }} –∏–∑ {{ autos_page.paginator.num_pages }}</span>

    {% if autos_page.has_next %}
        <a href="?page={{ autos_page.next_page_number }}">–°–ª–µ–¥—É—é—â–∞—è</a>
        <a href="?page={{ autos_page.paginator.num_pages }}">–ü–æ—Å–ª–µ–¥–Ω—è—è</a>
    {% endif %}
</div>
<h2>–ö—É–ø–∏–ª–∏ —Ç–æ–ª—å–∫–æ —á—Ç–æ üî•</h2>
<ul>
    {% not_available_autos as autos %}
    {% for auto in autos %}
        <li>{{ auto.brand.name }} {{ auto.model }} ({{ auto.year }})</li>
    {% endfor %}
</ul>

{% endblock %}
